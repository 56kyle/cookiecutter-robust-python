# .github/workflows/docs-build-rust.yml
# See https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions

name: Build Rust Documentation (Optional)

# This workflow is only generated if the 'Add Rust extension' option is selected.
# It's triggered when Rust code documentation might change (e.g., code or Rust docs source).

on:
  pull_request:
    paths:
      - 'rust/**' # Rust source code and docs (assuming docs embedded in rust)
      - '.github/workflows/docs-build-rust.yml' # This workflow file
      # Add paths to Rust doc-related files if any (e.g., top-level README for Rust crate)
  push:
    branches:
      - main
    paths:
      - 'rust/**'
      - '.github/workflows/docs-build-rust.yml'

  workflow_dispatch:

jobs:
  build-rust-docs:
    name: Run Rust Documentation Build Check
    # Rust documentation build (e.g., via cargo doc) usually runs on Linux.
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install Rust toolchain
        uses: dtolnay/rust-toolchain@stable

      - name: Install uv and set up Python
        uses: astral-sh/setup-uv@v6
        with:
          python-version-file: .python-version

      # Note: Python setup may be needed here if the Rust doc process
      # relies on a Python environment (e.g., for running scripts).
      # If using `nox -s docs-rust`, the nox session would handle Python/deps.
      # Let's assume the process might just use 'cargo doc'.

      - name: Build Rust documentation
        # Command depends on how Rust docs are built (cargo doc, or via a Nox session)
        # Option 1: Directly use cargo doc if that's the Rust doc tool
        # working-directory: rust # Assuming rust source is in ./rust
        # run: cargo doc --no-deps --all-features # Example cargo command
        run: uvx nox -s docs-rust # This could be sped up by skipping nox, but that would increase complexity

      - name: Upload Rust documentation (HTML) Artifact (Optional)
        uses: actions/upload-artifact@v4
        with:
          name: html-rust-docs
          # Path where 'cargo doc' or 'nox -s docs-rust' builds Rust docs (often target/doc)
          # Update this path based on actual build output
          path: rust/target/doc/ # Example path for cargo doc output
          retention-days: 5
